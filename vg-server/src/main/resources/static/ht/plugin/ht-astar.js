!function(n,C,f){"use strict";var y=n.ht;y.Astar={},function(x){var C=x();n.AStar=C.astar,n.AStar.Graph=C.Graph}(function(){function j(e){for(var l=e,$=[];l.parent;)$.unshift(l),l=l.parent;return $}function Q(){return new _(function(j){return j.f})}function u(Y,o){o=o||{},this.nodes=[],this.diagonal=!!o.diagonal,this.grid=[];for(var j=0;j<Y.length;j++){this.grid[j]=[];for(var l=0,q=Y[j];l<q.length;l++){var U=new S(j,l,q[l]);this.grid[j][l]=U,this.nodes.push(U)}}this.$13x()}function S(m,i,L){this.x=m,this.y=i,this.weight=L}function _(I){this.content=[],this.scoreFunction=I}var I={search:function(s,y,m,z){s.$6x(),z=z||{};var d=z.heuristic;d||(d=s.diagonal?I.$4x.diagonal:I.$4x.manhattan);var M=z.closest||!1,G=z.punish,Y=Q(),i=y;for(y.h=d(y,m),s.$7x(y),Y.push(y);Y.size()>0;){var R=Y.pop();if(R===m)return j(R);R.closed=!0;for(var e=s.neighbors(R),p=0,C=e.length;C>p;++p){var F=e[p];if(!F.closed&&!F.$9x()){var l=R.g+F.getCost(R,G),D=F.visited;(!D||l<F.g)&&(F.visited=!0,F.parent=R,F.h=F.h||d(F,m),F.g=l,F.f=F.g+F.h,s.$7x(F),M&&(F.h<i.h||F.h===i.h&&F.g<i.g)&&(i=F),D?Y.$10x(F):Y.push(F))}}}return M?j(i):[]},$4x:{manhattan:function(A,N){var R=Math.abs(N.x-A.x),o=Math.abs(N.y-A.y);return R+o},diagonal:function(N,m){var P=1,s=Math.sqrt(2),z=Math.abs(m.x-N.x),C=Math.abs(m.y-N.y);return P*(z+C)+(s-2*P)*Math.min(z,C)}},$5x:function(j){j.f=0,j.g=0,j.h=0,j.visited=!1,j.closed=!1,j.parent=null}};return u.prototype.$13x=function(){this.dirtyNodes=[];for(var e=0;e<this.nodes.length;e++)I.$5x(this.nodes[e])},u.prototype.$6x=function(){for(var Z=0;Z<this.dirtyNodes.length;Z++)I.$5x(this.dirtyNodes[Z]);this.dirtyNodes=[]},u.prototype.$7x=function(y){this.dirtyNodes.push(y)},u.prototype.neighbors=function(r){var v=[],b=r.x,n=r.y,B=this.grid;return B[b-1]&&B[b-1][n]&&v.push(B[b-1][n]),B[b+1]&&B[b+1][n]&&v.push(B[b+1][n]),B[b]&&B[b][n-1]&&v.push(B[b][n-1]),B[b]&&B[b][n+1]&&v.push(B[b][n+1]),this.diagonal&&(B[b-1]&&B[b-1][n-1]&&v.push(B[b-1][n-1]),B[b+1]&&B[b+1][n-1]&&v.push(B[b+1][n-1]),B[b-1]&&B[b-1][n+1]&&v.push(B[b-1][n+1]),B[b+1]&&B[b+1][n+1]&&v.push(B[b+1][n+1])),v},u.prototype.toString=function(){for(var n=[],J=this.grid,G=0;G<J.length;G++){for(var l=[],f=J[G],I=0;I<f.length;I++)l.push(f[I].weight);n.push(l.join(" "))}return n.join("\n")},S.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},S.prototype.getCost=function(E,U){var j;if(j=E&&E.x!=this.x&&E.y!=this.y?1.41421*this.weight:this.weight,U){var y=E;if(!y)return j;var Y=y.parent;return Y?Math.abs(Y.x+this.x-2*y.x)>1e-5?j+U:Math.abs(Y.y+this.y-2*y.y)>1e-5?j+U:j:j}},S.prototype.$9x=function(){return 0===this.weight},_.prototype={push:function(v){this.content.push(v),this.$11x(this.content.length-1)},pop:function(){var s=this.content[0],y=this.content.pop();return this.content.length>0&&(this.content[0]=y,this.$12x(0)),s},remove:function(T){var D=this.content.indexOf(T),X=this.content.pop();D!==this.content.length-1&&(this.content[D]=X,this.scoreFunction(X)<this.scoreFunction(T)?this.$11x(D):this.$12x(D))},size:function(){return this.content.length},$10x:function(G){this.$11x(this.content.indexOf(G))},$11x:function(Y){for(var T=this.content[Y];Y>0;){var X=(Y+1>>1)-1,c=this.content[X];if(!(this.scoreFunction(T)<this.scoreFunction(c)))break;this.content[X]=T,this.content[Y]=c,Y=X}},$12x:function(W){for(var n=this.content.length,s=this.content[W],G=this.scoreFunction(s);;){var $,Q=W+1<<1,F=Q-1,y=null;if(n>F){var E=this.content[F];$=this.scoreFunction(E),G>$&&(y=F)}if(n>Q){var I=this.content[Q],h=this.scoreFunction(I);(null===y?G:$)>h&&(y=Q)}if(null===y)break;this.content[W]=this.content[y],this.content[y]=s,W=y}}},{astar:I,Graph:u}});var s=y.Astar.Finder=function($,i){var o=this;o.gv=$,o.$13x(i),o.refreshMap()};s.prototype={},s.prototype.constructor=s,C.defineProperties(s.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(J){this.gv._astarDebugInfo=J}}}),s.prototype.$13x=function(Z){var H=this,t=H.$14x={};Z=Z||{};var k=Z.gridSize||10;t.gridSizeX=Z.gridSizeX||k,t.gridSizeY=Z.gridSizeY||k,t.rect=Z.rect,t.filter=Z.filter,t.extendBlocks=Z.extendBlocks||3,t.fastOverlap=Z.fastOverlap===f?!0:Z.fastOverlap,t.nodeRectExtend=Z.nodeRectExtend||0,t.diagonal=Z.diagonal===f?!0:Z.diagonal,t.turnPunish=Z.turnPunish===f?.1:Z.turnPunish,t.simplify=Z.simplify===f?!0:Z.simplify,t.toGridCenter=Z.toGridCenter===f?!1:Z.toGridCenter,t.closest=Z.closest===f?!0:Z.closest},s.prototype.refreshMap=function(){var N,I=this,T=I.$14x,E=T.gridSizeX,s=T.gridSizeY,Z=T.extendBlocks;T.rect?N=T.rect:(N=I.$15x(),y.Default.grow(N,E*Z,s*Z)),y.Default.grow(N,E,s);var W=Math.floor(N.x/E)*E,k=Math.floor(N.y/s)*s,B=Math.ceil(N.width/E),u=Math.ceil(N.height/s),K=B*E,L=u*s;I.$16x={x:W,y:k,w:K,h:L,gridX:E,gridY:s,xLen:B,yLen:u},I.$17x(),I.$21x()},s.prototype.$15x=function(){var H=this.gv;if(H instanceof y.graph.GraphView)return H.getContentRect();var m,G=y.Default.unionRect;return H.dm().each(function(j){H.isVisible(j)&&j.getRect&&(m=G(m,j.getRect()))}),m},s.prototype.$17x=function(){var v,Y,X,j,H=this,i=H.$16x,u=i.xLen,y=i.yLen;for(v=new Array(u),X=0;u>X;X++)for(v[X]=Y=new Array(y),j=y;j--;)Y[j]=1;var t=H.$14x.filter;for(H.gv.dm().each(function(s){t&&t(s)===!1||(!H._debugInfo||s!==H._debugInfo.grid&&s!=H._debugInfo.path)&&H.$1cw(v,s)}),X=0;u>X;X++)v[X][0]=1,v[X][y-1]=1;for(j=0;y>j;j++)v[0][j]=1,v[u-1][j]=1;H.grid=v;var a=new AStar.Graph(v,{diagonal:H.$14x.diagonal});H.graph=a},s.prototype.$18x=function(J,K,B,A,h,r,F,v){var O=this.$19x,C=O(B-J,h-F,A-K,r-v);if(1e-6>=C&&C>=-1e-6)return!1;var a=O(h-J,h-F,r-K,r-v)/C;if(0>a||a>1)return!1;var S=O(B-J,h-J,A-K,r-K)/C;return 0>S||S>1?!1:!0},s.prototype.$19x=function(c,O,A,s){return c*s-O*A},s.prototype.$1aw=function(w,g,G,o){for(var q=[-(g[1]-w[1]),g[0]-w[0]],L=q[0]*(G[0]-w[0])+q[1]*(G[1]-w[1])>=0,l=0,P=o.length;P>l;l+=2)if(q[0]*(o[l]-w[0])+q[1]*(o[l+1]-w[1])>=0===L)return!1;return!0},s.prototype.$1bw=function(E,Z){for(var d,a,P=this,X=0,A=E.length;A>X;X+=2)if(d=X===A-2?0:X+2,a=d===A-2?0:d+2,P.$1aw([E[X],E[X+1]],[E[d],E[d+1]],[E[a],E[a+1]],Z))return!1;for(var X=0,A=Z.length;A>X;X+=2)if(d=X===A-2?0:X+2,a=d===A-2?0:d+2,P.$1aw([Z[X],Z[X+1]],[Z[d],Z[d+1]],[Z[a],Z[a+1]],E))return!1;return!0},s.prototype.$1cw=function(a,q){if(q.getRect){var X=this,e=q.getRect();y.Default.grow(e,X.$14x.nodeRectExtend);var B,L,R,g,z,U,t,p,v,k,P,b=X.$1dw({x:e.x,y:e.y}),i=X.$1dw({x:e.x+e.width,y:e.y+e.height}),n=X.$14x.fastOverlap;if(!n){var Z=q.getCorners();t=[],Z.forEach(function(i){t.push(i.x,i.y)}),k=X.$14x.gridSizeX/2,P=X.$14x.gridSizeY/2}for(L=Math.max(0,b.x),R=Math.min(i.x,a.length-1),z=Math.max(0,b.y),U=Math.min(i.y,a.length?a[0].length-1:-1),B=L;R>=B;B++)for(g=z;U>=g;g++)if(n)a[B][g]=0;else{v=X.$1ew({x:B,y:g});var o=v.x-k,E=v.x+k,J=v.y-P,f=v.y+P;p=[o,J,o,f,E,f,E,J],X.$1bw(t,p)&&(a[B][g]=0)}}},s.prototype.$1dw=function(t,d){var k=this,X=k.$16x,e=(t.x-X.x)/X.gridX,o=(t.y-X.y)/X.gridY;return d!==!1&&(e=Math.round(e),o=Math.round(o)),{x:e,y:o}},s.prototype.$1ew=function(G){var e=this,V=e.$16x;return{x:G.x*V.gridX+V.x,y:G.y*V.gridY+V.y}},s.prototype.$1fw=function(L){var K=this,k=K.$16x,W=k.xLen,f=k.yLen;if(L.x>=0&&L.x<W&&L.y>=0&&L.y<f)return L;var z={x:L.x,y:L.y};return z.x<0?z.x=0:z.x>=W&&(z.x=W-1),z.y<0?z.y=0:z.y>=f&&(z.y=f-1),z},s.prototype.findPath=function(U,u){var B,z,s,G,A=this,N=A.$1dw(U),I=A.$1dw(u);if(s=A.$1fw(N),G=A.$1fw(I),s!==N&&G!==I){var S=A.$16x,C=S.x-S.gridX/2,l=S.y-S.gridY/2,m=C+S.gridX*S.xLen,y=l+S.gridY*S.yLen;if(!(A.$18x(U.x,U.y,u.x,u.y,C,l,m,l)||A.$18x(U.x,U.y,u.x,u.y,m,l,m,y)||A.$18x(U.x,U.y,u.x,u.y,m,y,C,y)||A.$18x(U.x,U.y,u.x,u.y,C,y,C,l)))return[U,u]}s!==N&&(B=!0,N=s),G!==I&&(z=!0,I=G);var t=A.graph.grid[N.x][N.y],v=A.graph.grid[I.x][I.y],j=AStar.search(A.graph,t,v,{closest:A.$14x.closest,punish:A.$14x.turnPunish});if(!j||!j.length)return null;var V=[];V.push(U),B&&V.push(A.$1ew(j[0]));for(var M=1,q=j.length;q-1>M;M++)V.push(A.$1ew(j[M]));if(z)V.push(A.$1ew(j[q-1])),V.push(u);else{var E=j[q-1];I.x!==E.x||I.y!==E.y||A.$14x.toGridCenter?V.push(A.$1ew(E)):V.push(u)}return A.$14x.simplify&&(V=A.simplifyPath(V)),A.$20x=V,A.$21x(),V},s.prototype.debugOn=function(J){this.debugFlag=!0,this.debugSettings=J||{},this.$21x()},s.prototype.simplifyPath=function(C){var u=C.length;if(2>=u)return C;var k,i,x=[C[0],C[1]],E=x[0],t=x[1],y=1e-5;for(k=2;u>k;k++)i=C[k],Math.abs((t.x-E.x)*(i.y-E.y)-(t.y-E.y)*(i.x-E.x))<y?t=x[x.length-1]=i:(E=t,t=i,x.push(i));return x},s.prototype.$21x=function(){var l=this;if(l.$22x(),this.debugFlag){var u=l.grid;if(u){var M,g=l.gv;if(l.debugSettings.$16x!==!1){M=[];for(var Z,U,Q,D,G,A=[],H=l.$14x.gridSizeX/2,C=l.$14x.gridSizeY/2,v=u.length,t=v?u[0].length:0,J=1;v-1>J;J++)for(var f=1;t-1>f;f++)u[J][f]||(Z=l.$1ew({x:J,y:f}),U=Z.x-H,Q=Z.x+H,D=Z.y-C,G=Z.y+C,M.push({x:U,y:D},{x:U,y:G},{x:Q,y:G},{x:Q,y:D}),A.push(1,2,2,2,5));var V=new y.Shape;V.s("shape.border.color","rgba(50, 50, 50, 0.2)"),V.s("shape.border.width",1),V.s("shape.background","rgba(200, 50, 100, 0.2)"),V.s("2d.editable",!1),V.s("2d.selectable",!1),V.setPoints(M),V.setSegments(A),l._debugInfo={grid:V},g.dm().add(V)}l.debugSettings.path!==!1&&(M=new y.Shape,l.$20x&&(M.setPoints(l.$20x),M.s("shape.border.color","red"),M.s("shape.border.width",1),M.s("2d.editable",!1),M.s("2d.selectable",!1),M.s("shape.background",null),l._debugInfo||(l._debugInfo={}),l._debugInfo.path=M,g.dm().add(M)))}}},s.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},s.prototype.$22x=function(){var $=this;if($._debugInfo){var v=$._debugInfo.grid,N=$._debugInfo.path,y=$.gv;v&&y.dm().remove(v),N&&y.dm().remove(N),$._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);