!function(R,f){"use strict";var c="ht",n=c+".layout.",r=R[c]||module.parent.exports.ht,B=r.List,O=r.DataModel,V=r.Node,N=r.Edge,p=r.Group,e=Math,L=e.sqrt,F=e.random,D=e.max,j=e.min,i=function(F){return F*F};r.Default.getInternal().addMSMap({ms_force:function(a){a._interval=50,a._stepCount=10,a._motionLimit=.01,a._edgeRepulsion=.65,a._nodeRepulsion=.65,a._damper=1,a._maxMotion=0,a._motionRatio=0,a.init=function(f){var R=this;f instanceof O?R.dm=f:R.gv=f,R._nodeMap={},R._nodes=new B,R._edges=new B},a.start=function(){var M=this,m=M.gv;if(!M._timer){var D=M.cdm=m?m.dm():M.dm;D.mm(M.handleDataModelChange,M),D.md(M.handleDataPropertyChange,M),m&&m.mp(M.handleGV,M),D.each(function(d){if(M.isVisible(d)&&M.isLayoutable(d)&&d instanceof V)if(M instanceof s){var B=d.p3();d.p3([B[0]+F(),B[1]+F(),B[2]+F()])}else B=d.p(),d.p(B.x+F(),B.y+F())}),M._timer=setInterval(function(){M.relax()},M._interval),M._damper=1}},a.stop=function(){var H=this;H._timer&&(H.cdm.umm(H.handleDataModelChange,H),H.cdm.umd(H.handleDataPropertyChange,H),H.gv&&H.gv.ump(H.handleGV,H),clearInterval(H._timer),delete H._timer,delete H.cdm)},a.handleGV=function(A){var X=this;if("dataModel"===A.property){var b=A.oldValue,H=A.newValue;b&&(b.umm(X.handleDataModelChange,X),b.umd(X.handleDataPropertyChange,X)),this.cdm=H,H.mm(X.handleDataModelChange,X),H.md(X.handleDataPropertyChange,X)}},a.relax=function(){var v=this;if(!(v._damper<.1&&v._maxMotion<v._motionLimit)){this.cdm.each(function(w){v.isVisible(w)&&(w instanceof N?v.addEdge(w):w instanceof V&&v.addNode(w))});for(var J,q,n=0,b=v._edges,g=v._nodes,A=g.size();n<v._stepCount;n++){for(b.each(v.relaxEdge,v),J=0;A>J;J++)for(q=0;A>q;q++)v.relaxNode(g.get(J),g.get(q));v.moveNode()}v._isAdjusting=1,g.each(function(j){j.fix||(j.p?j.v.p3(j.p):j.v.p(j.x,j.y))}),delete v._isAdjusting,v._nodeMap={},g.clear(),b.clear(),v.onRelaxed()}},a.onRelaxed=function(){},a.isRunning=function(){return!!this._timer},a.isVisible=function(n){return n.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(n):!0},a.isLayoutable=function(z){if(z.s("layoutable")===!1)return!1;if(z instanceof p)return!1;var q=this;return q.gv?q.gv.isMovable(z)&&!q.gv.isSelected(z):!(q.cdm||q.dm).sm().co(z)},a.getNodeRepulsion=function(){return this._nodeRepulsion},a.setNodeRepulsion=function(G){this._nodeRepulsion=G,this._damper=1},a.getEdgeRepulsion=function(){return this._edgeRepulsion},a.setEdgeRepulsion=function(o){this._edgeRepulsion=o,this._damper=1},a.getStepCount=function(){return this._stepCount},a.setStepCount=function(D){this._stepCount=D,this._damper=1},a.getInterval=function(){return this._interval},a.setInterval=function(n){var o=this;o._interval!==n&&(o._interval=n,o._timer&&(clearInterval(o._timer),o._timer=setInterval(function(){o.relax()},n)))},a.handleDataPropertyChange=function(x){!this._isAdjusting&&this.isVisible(x.data)&&(this._damper=1)},a.handleDataModelChange=function(){this._damper=1},a.damp=function(){var J=this._maxMotion,X=this._damper;this._motionRatio<=.001&&((.2>J||J>1&&.9>X)&&X>.01?this._damper-=.01:.4>J&&X>.003?this._damper-=.003:X>1e-4&&(this._damper-=1e-4)),J<this._motionLimit&&(this._damper=0)}}}),r.layout.ForceLayout=function(X){this.init(X)},r.Default.def(n+"ForceLayout",f,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(r){this._limitBounds=r,this._damper=1},getNodeSize:function(n){var v=this.gv;return v&&v.getDataUIBounds?v.getDataUIBounds(n):n.getRect()},addNode:function(Q){var c=this,I=c._nodeMap[Q._id];if(I)return I;var n=Q.p();I={v:Q,x:n.x,y:n.y,dx:0,dy:0,fix:!c.isLayoutable(Q),s:c.getNodeSize(Q)};var R=I.s,f=L(i(R.width)+i(R.height))*c._nodeRepulsion;return I.r=1>f?100:f,c._nodeMap[Q._id]=I,c._nodes.add(I),I},addEdge:function(Z){if(Z._40I&&Z._41I){var Q=this,B=Q.addNode(Z._40I),X=Q.addNode(Z._41I),S={s:B,t:X};X=X.s,B=B.s;var n=X.width+B.width,w=X.height+B.height;S.length=L(n*n+w*w)*Q._edgeRepulsion,S.length<=0&&(S.length=100),Q._edges.add(S)}},relaxEdge:function($){var n=$.t,d=$.s,q=n.x-d.x,O=n.y-d.y,G=L(q*q+O*O),D=100*$.length,h=.25*q/D*G,K=.25*O/D*G;n.dx=n.dx-h,n.dy=n.dy-K,d.dx=d.dx+h,d.dy=d.dy+K},relaxNode:function(Z,$){if(Z!==$){var Q=0,S=0,W=Z.x-$.x,I=Z.y-$.y,L=W*W+I*I;0===L?(Q=F(),S=F()):36e4>L&&(Q=W/L,S=I/L);var y=Z.r*$.r/400;Q*=y,S*=y,Z.dx+=Q,Z.dy+=S,$.dx-=Q,$.dy-=S}},moveNode:function(){var r=this,W=r._limitBounds,g=r._maxMotion,m=0,M=r._damper;r._nodes.each(function(z){if(!z.fix){var B=z.dx*M,K=z.dy*M;if(z.dx=B/2,z.dy=K/2,m=D(L(B*B+K*K),m),z.x+=D(-40,j(40,B)),z.y+=D(-40,j(40,K)),W){z.x<W.x&&(z.x=W.x,r.adjust(1,0)),z.y<W.y&&(z.y=W.y,r.adjust(0,1));var i=z.s;z.x+i.width>W.x+W.width&&(z.x=W.x+W.width-i.width,r.adjust(-1,0)),z.y+i.height>W.y+W.height&&(z.y=W.y+W.height-i.height,r.adjust(0,-1))}}}),r._maxMotion=m,r._motionRatio=m>0?g/m-1:0,r.damp()},adjust:function(R,z){var i=this._limitBounds;this._nodes.each(function(n){R>0?(!i||n.x+n.s.width+R<i.x+i.width)&&(n.x+=R):(!i||n.x+R>i.x)&&(n.x+=R),z>0?(!i||n.y+n.s.height+z<i.y+i.height)&&(n.y+=z):(!i||n.y+z>i.y)&&(n.y+=z)})}});var s=r.layout.Force3dLayout=function(G){this.init(G)};r.Default.def(n+"Force3dLayout",f,{ms_force:1,getNodeSize3d:function(k){return k.s3()},addNode:function(X){var B=this,F=B._nodeMap[X._id];if(F)return F;F={v:X,p:X.p3(),d:[0,0,0],fix:!B.isLayoutable(X),s:B.getNodeSize3d(X)};var U=F.s,A=r.Default.getDistance(U)*B._nodeRepulsion;return F.r=1>A?100:A,B._nodeMap[X._id]=F,B._nodes.add(F),F},addEdge:function(y){if(y._40I&&y._41I){var M=this,$=M.addNode(y._40I),q=M.addNode(y._41I),k={s:$,t:q};q=q.s,$=$.s,k.length=L(i(q[0]+$[0])+i(q[1]+$[1])+i(q[2]+$[2]))*M._edgeRepulsion,k.length<=0&&(k.length=100),M._edges.add(k)}},relaxEdge:function(E){var V=E.t.p,y=E.s.p,N=E.t.d,t=E.s.d,T=V[0]-y[0],n=V[1]-y[1],h=V[2]-y[2],F=L(T*T+n*n+h*h),l=100*E.length,X=.25*T/l*F,P=.25*n/l*F,Z=.25*h/l*F;N[0]-=X,N[1]-=P,N[2]-=Z,t[0]+=X,t[1]+=P,t[2]+=Z},relaxNode:function(D,h){if(D!==h){var w=D.p,n=h.p,T=0,g=0,s=0,P=w[0]-n[0],A=w[1]-n[1],r=w[2]-n[2],b=P*P+A*A+r*r;0===b?(T=F(),g=F(),s=F()):216e6>b&&(T=P/b,g=A/b,s=r/b);var q=D.r*h.r/400,y=D.d,K=h.d;T*=q,g*=q,s*=q,y[0]+=T,y[1]+=g,y[2]+=s,K[0]-=T,K[1]-=g,K[2]-=s}},moveNode:function(){var w=this,G=w._maxMotion,i=0,d=w._damper;w._nodes.each(function(K){if(!K.fix){var o=K.p,N=K.d,v=N[0]*d,E=N[1]*d,C=N[2]*d;N[0]=v/2,N[1]=E/2,N[2]=C/2,i=D(L(v*v+E*E+C*C),i),o[0]+=D(-40,j(40,v)),o[1]+=D(-40,j(40,E)),o[2]+=D(-40,j(40,C))}}),w._maxMotion=i,w._motionRatio=i>0?G/i-1:0,w.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);