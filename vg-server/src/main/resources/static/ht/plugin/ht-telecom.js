!function(d,I){"use strict";var N=ht.AlarmSeverity=function(y,R,f,g,I){this.value=y,this.name=R,this.nickName=f,this.color=g,this.displayName=I};ht.Default.def("ht.AlarmSeverity",I,{toString:function(){return this.displayName||this.name}}),function(){N.severities=new ht.List,N._vm={},N._nm={},N._cp=function(G,u){if(G&&u){var $=G.value-u.value;return $>0?1:0>$?-1:0}return G&&!u?1:!G&&u?-1:0},N.each=function(L,d){N.severities.each(L,d)},N.getSortFunction=function(){return N._cp},N.setSortFunction=function(z){N._cp=z,N.severities.sort(z)},N.add=function(c,y,P,O,I){var Y=new N(c,y,P,O,I);return N._vm[c]=Y,N._nm[y]=Y,N.severities.add(Y),N.severities.sort(N._cp),Y},N.remove=function(_){var c=N._nm[_];return c&&(delete N._nm[_],delete N._vm[c.value],N.severities.remove(c)),c},N.CRITICAL=N.add(500,"Critical","C","#FF0000"),N.MAJOR=N.add(400,"Major","M","#FFA000"),N.MINOR=N.add(300,"Minor","m","#FFFF00"),N.WARNING=N.add(200,"Warning","W","#00FFFF"),N.INDETERMINATE=N.add(100,"Indeterminate","N","#C800FF"),N.CLEARED=N.add(0,"Cleared","R","#00FF00"),N.isClearedAlarmSeverity=function(N){return N?0===N.value:!1},N.getByName=function(Q){return N._nm[Q]},N.getByValue=function(n){return N._vm[n]},N.clear=function(){N.severities.clear(),N._vm={},N._nm={}},N.compare=function(F,H){return N._cp(F,H)}}();var S=ht.AlarmState=function(V){this._d=V,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",I,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var m=null;for(var k in this._am)k=N.getByName(k),N.isClearedAlarmSeverity(k)||0!==this.getAcknowledgedAlarmCount(k)&&(m=m?N.compare(m,k)>0?m:k:k);this._haa=m},_c2:function(){var W=null;for(var d in this._nm)d=N.getByName(d),N.isClearedAlarmSeverity(d)||0!==this.getNewAlarmCount(d)&&(W=W?N.compare(W,d)>0?W:d:d);this._hna=W},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var w in this._nm)if(w=N.getByName(w),!N.isClearedAlarmSeverity(w)&&0!==this.getNewAlarmCount(w)&&N.compare(this._hna,w)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var Z=this._haa,B=this._hna,m=this._ps;this._hoa=Z,N.compare(B,this._hoa)>0&&(this._hoa=B),N.compare(m,this._hoa)>0&&(this._hoa=m)},_c5:function(){var p=this._haa,V=this._hna;this._hta=p,N.compare(V,this._hta)>0&&(this._hta=V)},increaseAcknowledgedAlarm:function(p,z){if(0!==z){z=z||1;var s=this._am[p.name]||0;s+=z,this._am[p.name]=s,this._f()}},increaseNewAlarm:function(t,j){if(0!==j){j=j||1;var m=this._nm[t.name]||0;m+=j,this._nm[t.name]=m,this._f()}},decreaseAcknowledgedAlarm:function(c,m){if(0!==m){m||(m=1);var U=this._am[c.name]||0;if(U-=m,0>U)throw"Alarm count can not be negative";this._am[c.name]=U,this._f()}},decreaseNewAlarm:function($,u){if(0!==u){u||(u=1);var b=this._nm[$.name]||0;if(b-=u,0>b)throw"Alarm count can not be negative";this._nm[$.name]=b,this._f()}},acknowledgeAlarm:function(n){this.decreaseNewAlarm(n,1),this.increaseAcknowledgedAlarm(n,1)},acknowledgeAllAlarms:function(S){if(S){var r=this.getNewAlarmCount(S);this.decreaseNewAlarm(S,r),this.increaseAcknowledgedAlarm(S,r)}else for(var d in this._nm)this.acknowledgeAllAlarms(N.getByName(d))},_c6:function(){this._aac=0;for(var S in this._am)S=N.getByName(S),this._aac+=this.getAcknowledgedAlarmCount(S)},getAcknowledgedAlarmCount:function(Z){return Z?this._am[Z.name]||0:this._aac},getAlarmCount:function(D){return this.getAcknowledgedAlarmCount(D)+this.getNewAlarmCount(D)},_c7:function(){this._nac=0;for(var E in this._nm)this._nac+=this.getNewAlarmCount(N.getByName(E))},getNewAlarmCount:function(M){return M?this._nm[M.name]||0:this._nac},setNewAlarmCount:function(j,W){this._nm[j.name]=W,this._f()},removeAllNewAlarms:function(R){R?delete this._nm[R]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(s,X){this._am[s.name]=X,this._f()},removeAllAcknowledgedAlarms:function(T){T?delete this._am[T.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(c){if(this._ep||(c=null),this._ps!==c){var z=this._ps;this._ps=c,this._f(),this._d.fp("propagateSeverity",z,c)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(X){var t=this._ep;this._ep=X,this._d.fp("enablePropagation",t,X)&&(X||this.setPropagateSeverity(null))}});var h=ht.AlarmStatePropagator=function(e){this._dataModel=e,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",I,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(B){this._enable!==B&&(this._enable=B,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(c){this.propagate(c)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(u){u.data&&this.propagate(u.data)},handleDataPropertyChange:function(o){if("alarmState"===o.property||"enablePropagation"===o.property)this.propagate(o.data);else if("parent"===o.property){var q=o.oldValue;q&&this.propagate(q),this.propagate(o.data)}},propagate:function(c){c&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(c),this._isPropagating=!1)},propagateToTop:function(W){for(this.propagateToParent(null,W);W&&W.getParent();)this.propagateToParent(W,W.getParent()),W=W.getParent()},propagateToParent:function(k,F){var d=null;F.getChildren().each(function(j){var z=j.getAlarmState().getHighestOverallAlarmSeverity();N.compare(z,d)>0&&(d=z)}),F.getAlarmState().setPropagateSeverity(d)}}),ht.AlarmStateStatistics=function(L){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(L)},ht.Default.def("ht.AlarmStateStatistics",I,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(V){var v=this._dataModel;v!==V&&(v&&(v.umd(this.handleDataPropertyChange,this),v.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=V,this.reset(),V.md(this.handleDataPropertyChange,this),V.mm(this.handleDataModelChange,this),this.fp("dataModel",v,V))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(v){"alarmState"===v.property&&(this.increase(v.data),this.fireAlarmStateChange())},handleDataModelChange:function(j){"add"===j.kind?(this.increase(j.data),this.fireAlarmStateChange()):"remove"===j.kind?(this.decrease(j.data),this.fireAlarmStateChange()):"clear"===j.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,N.each(function(N){var S=this.getSumInfo(N);this.sumAcked+=S.ackedCount,this.sumNew+=S.newCount,this.sumTotal+=S.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(O){if(!O)return this.sumNew;var X=this.getSumInfo(O);return X.newCount},getAcknowledgedAlarmCount:function(G){if(!G)return this.sumAcked;var x=this.getSumInfo(G);return x.ackedCount},getTotalAlarmCount:function(i){if(!i)return this.sumTotal;var I=this.getSumInfo(i);return I.totalCount},getSumInfo:function(e){var R=this.severtiyMap[e.name];return R||(R={},R.newCount=0,R.ackedCount=0,R.totalCount=0,this.severtiyMap[e.name]=R),R},decrease:function(D){var j=this.dataMap[D.getId()];j&&(delete this.dataMap[D.getId()],N.each(function(B){var G=j[B.name],p=this.getSumInfo(B);p.newCount=p.newCount-G.newCount,p.ackedCount=p.ackedCount-G.ackedCount,p.totalCount=p.totalCount-G.totalCount},this))},increase:function(h){if(this.decrease(h),!this._filterFunc||this._filterFunc(h)){var s={},O=h.getAlarmState();this.dataMap[h.getId()]=s,N.each(function(Y){var F={};F.newCount=O.getNewAlarmCount(Y),F.ackedCount=O.getAcknowledgedAlarmCount(Y),F.totalCount=O.getAlarmCount(Y),s[Y.name]=F;var V=this.getSumInfo(Y);V.newCount=V.newCount+F.newCount,V.ackedCount=V.ackedCount+F.ackedCount,V.totalCount=V.totalCount+F.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(C){var $=this._filterFunc;this._filterFunc=C,this.reset(),this.fp("filterFunc",$,C)},getFilterFunc:function(){return this._filterFunc}});var x=ht.Data.prototype;x.getAlarmState=function(){return this._alarmState||(this._alarmState=new S(this))},x=ht.DataModel.prototype,x.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},x.setEnableAlarmStatePropagator=function(Y){Y!=this.isEnableAlarmStatePropagator()&&(Y?(this._alarmStatePropagator=new h(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},x=ht.graph.GraphView.prototype,x.getNote2=function(y){var G=y.getAlarmState().getHighestNewAlarmSeverity();if(G){var L=y.getAlarmState().getNewAlarmCount(G)+G.nickName;return y.getAlarmState().hasLessSevereNewAlarms()&&(L+="+"),L}return y.s("note2")},x.getNote2Background=function(Y){var K=Y.getAlarmState().getHighestNewAlarmSeverity();return K?K.color:Y.s("note2.background")},x.getBodyColor=function(H){var j=H.getAlarmState().getHighestNativeAlarmSeverity();return j?j.color:H.s("body.color")},x.getBorderColor=function(T){var v=T.getAlarmState().getPropagateSeverity();return v?v.color:T.s("border.color")},x=ht.widget.TreeView.prototype,x.getBorderColor=function(h){var X=h.getAlarmState().getPropagateSeverity();return X?X.color:h.s("border.color")},x.getIcon=function(n){return n.getIcon()?"__alarmIcon__":null},x=ht.widget.TreeTableView.prototype,x.getBorderColor=function(c){var _=c.getAlarmState().getPropagateSeverity();return _?_.color:c.s("border.color")},x.getIcon=function(_){return _.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(F){return F.getIcon()}},color:{func:function(L){var H=L.getAlarmState().getHighestNativeAlarmSeverity();return H?H.color:L.s("body.color")}},rect:[0,0,16,16]}]});var z=ht.Style;z["note2.expanded"]=!0,z["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);